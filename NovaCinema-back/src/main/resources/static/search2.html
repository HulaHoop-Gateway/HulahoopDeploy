<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ì˜ˆë§¤ ë° ì¢Œì„ ì˜ˆì•½ ì •ë³´</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; line-height: 1.6; }
        .card { border: 1px solid #ccc; padding: 12px; margin-bottom: 16px; border-radius: 6px; background: #f9f9f9; }
        h2 { margin-top: 40px; }
    </style>
</head>
<body>
<h1>ğŸ« ì˜ˆë§¤ ì •ë³´ + ğŸ’º ì¢Œì„ ì˜ˆì•½ ì •ë³´</h1>

<!-- ë²„íŠ¼ -->
<button onclick="loadReservations()">ğŸ“‹ ì˜ˆë§¤ ì •ë³´ ì¡°íšŒ</button>
<button onclick="loadSeatReservations()">ğŸ’º ì¢Œì„ ì˜ˆì•½ ì •ë³´ ì¡°íšŒ</button>

<!-- ì¶œë ¥ ì˜ì—­ -->
<div id="reservationSection"></div>
<hr>
<div id="seatReservationSection"></div>

<script>
    function clearAllSections() {
        document.getElementById('reservationSection').innerHTML = '';
        document.getElementById('seatReservationSection').innerHTML = '';
    }

    function loadReservations() {
        clearAllSections(); // ğŸ”„ ëª¨ë“  ì˜ì—­ ì´ˆê¸°í™”
        fetch('http://localhost:8082/reservation/list')
            .then(res => res.json())
            .then(data => renderReservations(data))
            .catch(err => {
                console.error('ì˜ˆë§¤ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', err);
                document.getElementById('reservationSection').innerHTML = '<p style="color:red;">ì˜ˆë§¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            });
    }

    function loadSeatReservations() {
        clearAllSections(); // ğŸ”„ ëª¨ë“  ì˜ì—­ ì´ˆê¸°í™”
        fetch('http://localhost:8082/seatReservation/list')
            .then(res => res.json())
            .then(data => renderSeatReservations(data))
            .catch(err => {
                console.error('ì¢Œì„ ì˜ˆì•½ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', err);
                document.getElementById('seatReservationSection').innerHTML = '<p style="color:red;">ì¢Œì„ ì˜ˆì•½ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            });
    }

    function renderReservations(data) {
        const container = document.getElementById('reservationSection');
        const title = document.createElement('h2');
        title.textContent = 'ğŸ“‹ ì˜ˆë§¤ ì •ë³´';
        container.appendChild(title);

        data.forEach(r => {
            const seat = r.seatDTO || {};
            const user = r.userDTO || {};
            const schedule = r.scheduleDTO || {};
            const movie = schedule.movieInfo || {};
            const theater = schedule.theaterInfo || {};
            const cinema = theater.cinemaFranchisedto || {};

            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                <strong>ì˜ˆì•½ë²ˆí˜¸:</strong> ${r.reservationNum}<br>
                <strong>íšŒì›:</strong> ${user.memberName || ''} (${user.phoneNumber || ''})<br>
                <strong>ì¢Œì„:</strong> ${seat.rowLabel || ''}${seat.colNum || ''} (${seat.seatType || ''})<br>
                <strong>ê°€ê²©:</strong> ${seat.price?.toLocaleString() || ''}ì›<br>
                <strong>ì˜í™”:</strong> ${movie.movieTitle || ''} (${movie.audienceRating || ''})<br>
                <strong>ìƒì˜ì¼ì‹œ:</strong> ${schedule.screeningDate || ''}<br>
                <strong>ìƒì˜ê´€:</strong> ${theater.screeningNumber || ''}<br>
                <strong>ì§€ì :</strong> ${cinema.branchName || ''} / ${cinema.address || ''}<br>
                <strong>ê²°ì œì‹œê°„:</strong> ${r.paymentTime}<br>
                <strong>ìƒíƒœ:</strong> ${r.state}
            `;
            container.appendChild(div);
        });
    }

    function renderSeatReservations(data) {
        const container = document.getElementById('seatReservationSection');
        const title = document.createElement('h2');
        title.textContent = 'ğŸ’º ì¢Œì„ ì˜ˆì•½ ì •ë³´';
        container.appendChild(title);

        data.forEach(r => {
            const seat = r.seatDTO || {};
            const schedule = r.scheduleDTO || {};
            const movie = schedule.movieInfo || {};
            const theater = schedule.theaterInfo || {};
            const cinema = theater.cinemaFranchisedto || {};

            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                <strong>ì˜ˆì•½ID:</strong> ${r.reservationId}<br>
                <strong>ìŠ¤ì¼€ì¤„ë²ˆí˜¸:</strong> ${r.scheduleNum}<br>
                <strong>ì¢Œì„ì½”ë“œ:</strong> ${r.seatCode}<br>
                <strong>ì¢Œì„:</strong> ${seat.rowLabel || ''}${seat.colNum || ''} (${seat.seatType || ''})<br>
                <strong>ê°€ê²©:</strong> ${seat.price?.toLocaleString() || ''}ì›<br>
                <strong>ì˜í™”:</strong> ${movie.movieTitle || ''} (${movie.audienceRating || ''})<br>
                <strong>ìƒì˜ì¼ì‹œ:</strong> ${schedule.screeningDate || ''}<br>
                <strong>ìƒì˜ê´€:</strong> ${theater.screeningNumber || ''}<br>
                <strong>ì§€ì :</strong> ${cinema.branchName || ''} / ${cinema.address || ''}<br>
                <strong>ì˜ˆì•½ìƒíƒœ:</strong> ${r.reserved ? 'ì˜ˆì•½ë¨' : 'ì·¨ì†Œë¨'}<br>
                <strong>ì˜ˆì•½ì‹œê°„:</strong> ${r.reservedAt}
            `;
            container.appendChild(div);
        });
    }
</script>
</body>
</html>
