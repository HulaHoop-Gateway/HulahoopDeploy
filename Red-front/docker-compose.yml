services:
  # ===========================
  # Gateway (API Entry)
  # ===========================
  gateway-back:
    build: ./gateway/Gateway
    container_name: gateway-back
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - JAVA_TOOL_OPTIONS=-Xmx256m
    depends_on:
      - blue-back
      - red-back
      - cinema-back
      - bike-back
    networks:
      - app-net

  # ===========================
  # Blue (AI Chat)
  # ===========================
  blue-front:
    build: ./Blue-front
    container_name: blue-front
    ports:
      - "5173:5173"
    networks:
      - app-net

  blue-back:
    build: ./Blue-back/blue-back
    container_name: blue-back
    ports:
      - "8090:8090"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - JAVA_TOOL_OPTIONS=-Xmx256m
    depends_on:
      - db-blue-red
    networks:
      - app-net

  # ===========================
  # Red (Admin Front/Back)
  # ===========================
  red-front:
    build: ./Red-front/Red-front
    container_name: red-front
    ports:
      - "3000:3000"
    networks:
      - app-net

  red-back:
    build: ./Red-back/red-back
    container_name: red-back
    ports:
      - "8000:8000"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - JAVA_TOOL_OPTIONS=-Xmx256m
    depends_on:
      - db-blue-red
    networks:
      - app-net

  # ===========================
  # Cinema (Movie)
  # ===========================
  cinema-front:
    build: ./NovaCinema-front/Green-Cinema-front
    container_name: cinema-front
    ports:
      - "5175:5175"
    networks:
      - app-net

  cinema-back:
    build: ./NovaCinema-back
    container_name: cinema-back
    ports:
      - "8082:8082"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - JAVA_TOOL_OPTIONS=-Xmx256m
    depends_on:
      - db-cinema
    networks:
      - app-net

  # ===========================
  # Bike (Bikeway)
  # ===========================
  bike-front:
    build: ./Bikeway-front/Green-Bicycle-front/bikeway-front
    container_name: bike-front
    ports:
      - "5174:5174"
    networks:
      - app-net

  bike-back:
    build: ./Bikeway-back/bikeway-back
    container_name: bike-back
    ports:
      - "8081:8081"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - JAVA_TOOL_OPTIONS=-Xmx256m
    depends_on:
      - db-bike
    networks:
      - app-net

  # ===========================
  # DATABASES (MySQL Ã— 3)
  # ===========================
  db-blue-red:
    image: mysql:8
    container_name: db-blue-red
    environment:
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_DATABASE=hulahoopdb
    volumes:
      - db-blue-red-data:/var/lib/mysql
      - ./db-init/hulahoopdb.sql:/docker-entrypoint-initdb.d/1-hulahoopdb.sql
    networks:
      - app-net

  db-bike:
    image: mysql:8
    container_name: db-bike
    environment:
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_DATABASE=bikewaydb
    volumes:
      - db-bike-data:/var/lib/mysql
      - ./db-init/Bikeway.sql:/docker-entrypoint-initdb.d/1-bikeway.sql
    networks:
      - app-net

  db-cinema:
    image: mysql:8
    container_name: db-cinema
    environment:
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_DATABASE=cinemadb
    volumes:
      - db-cinema-data:/var/lib/mysql
      - ./db-init/cinemadb.sql:/docker-entrypoint-initdb.d/1-cinemadb.sql
    networks:
      - app-net

# ===========================
# Networks & Volumes
# ===========================
networks:
  app-net:

volumes:
  db-blue-red-data:
  db-bike-data:
  db-cinema-data:
